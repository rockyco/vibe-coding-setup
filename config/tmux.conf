# Mobile-friendly tmux config for Claude Code sessions
# Optimized for iOS keyboard (no Ctrl/Tab keys) and touch interaction

# =============================================================================
# Part 1: Change Prefix to Single Quote
# =============================================================================
# iOS keyboards lack Ctrl key, making Ctrl+B inaccessible
# Single quote is directly accessible on all keyboards

unbind C-b
set-option -g prefix "'"
bind-key "'" send-prefix

# Double-tap ' to send literal single quote
bind "'" send-keys "'"

# =============================================================================
# Part 2: Control Key Alternatives (Prefix + lowercase letter)
# =============================================================================
# Pattern: 'x sends Ctrl+X - makes shell operations possible on iOS

# 'c sends Ctrl+C (interrupt)
bind c send-keys C-c
# 'd sends Ctrl+D (EOF/exit)
bind d send-keys C-d
# 'l sends Ctrl+L (clear screen)
bind l send-keys C-l
# 'z sends Ctrl+Z (suspend)
bind z send-keys C-z
# 'a sends Ctrl+A (beginning of line)
bind a send-keys C-a
# 'e sends Ctrl+E (end of line)
bind e send-keys C-e
# 'k sends Ctrl+K (kill to end of line)
bind k send-keys C-k
# 'u sends Ctrl+U (kill to beginning of line)
bind u send-keys C-u
# 'w sends Ctrl+W (delete word backward)
bind w send-keys C-w
# 'r sends Ctrl+R (reverse search history)
bind r send-keys C-r

# =============================================================================
# Part 3: Tab, Escape, and Arrow Keys
# =============================================================================
# iOS keyboards lack Tab and arrow keys

# Tab completion - 't sends Tab, 'T sends Shift+Tab
bind t send-keys Tab
bind T send-keys BTab

# Escape key - 'Escape or '[ sends Escape
bind Escape send-keys Escape
bind [ send-keys Escape

# Arrow keys for command history navigation
# 'i/'o for Up/Down (history prev/next) - i=up, o=down (adjacent keys)
bind i send-keys Up
bind o send-keys Down

# Left/Right arrows for cursor movement
# 'b (back) and 'f (forward) - matches emacs/readline conventions
bind b send-keys Left
bind f send-keys Right

# =============================================================================
# Part 4: Tmux Operations (Prefix + Shift or other keys)
# =============================================================================
# Use uppercase/other keys to avoid conflicts with Ctrl alternatives

# Window management
bind C new-window -c "#{pane_current_path}"       # 'C = new window
bind N next-window                                 # 'N = next window
bind P previous-window                             # 'P = previous window
bind W choose-window                               # 'W = choose window

# Pane management
bind v split-window -h -c "#{pane_current_path}"  # 'v = vertical split
bind s split-window -v -c "#{pane_current_path}"  # 's = horizontal split
bind Z resize-pane -Z                              # 'Z = zoom toggle
bind X confirm-before -p "Kill pane? (y/n)" kill-pane  # 'X = kill pane

# Pane navigation (vim-style with Shift to avoid conflicts)
bind H select-pane -L                              # 'H = left pane
bind J select-pane -D                              # 'J = down pane
bind K select-pane -U                              # 'K = up pane
bind L select-pane -R                              # 'L = right pane

# Session management
bind D detach-client                               # 'D = detach
bind S choose-session                              # 'S = choose session

# Copy mode
bind Enter copy-mode                               # 'Enter = copy mode
bind V paste-buffer                                # 'V = paste

# =============================================================================
# Part 5: Floating Popup Terminal (tmux 3.2+)
# =============================================================================

# Floating popup terminal - quick command execution
bind p display-popup -E -w 80% -h 80% "tmux new-session -A -s popup"
# Git popup - lazygit or git status
bind g display-popup -E -w 60% -h 60% -d "#{pane_current_path}" "lazygit || git status"

# =============================================================================
# Part 6: Touch Screen Selection and Copy
# =============================================================================

# Enable mouse mode (touch-friendly scrolling and selection)
set -g mouse on

# Enable OSC 52 clipboard integration (works with xterm.js/ttyd)
set -g set-clipboard on

# Auto-copy on mouse drag release (touch screen friendly)
# When you finish selecting text, it's automatically copied to tmux buffer
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel

# Copy to system clipboard via OSC 52 (requires terminal support)
# 'y in copy mode copies selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel

# Show buffer in popup for manual iOS copy (Safari blocks Clipboard API)
bind Y display-popup -E -w 80% -h 60% "tmux show-buffer 2>/dev/null || echo 'Buffer empty'"

# Copy mode improvements (vi style)
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection

# =============================================================================
# Part 7: Prefix-Free Bindings (Alt/Option key shortcuts)
# =============================================================================
# These work without prefix - useful if iOS keyboard has Option/Alt

# Alt + arrow keys for pane navigation
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Alt + p for popup (no prefix needed)
bind -n M-p display-popup -E -w 80% -h 80% "tmux new-session -A -s popup"

# =============================================================================
# General Settings (preserved from original config)
# =============================================================================

# Increase scrollback buffer (useful for long Claude outputs)
set -g history-limit 50000

# Reduce escape delay (faster response)
set -sg escape-time 10

# Status bar - tap window names to switch
set -g status-style 'bg=#1a1a2e fg=#eaeaea'
set -g status-position top
set -g status-left ''
set -g status-right ' %H:%M '
set -g status-justify left

# Window list style - make tabs clear and tappable
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format ' [#I:#W] '
setw -g window-status-current-style 'bg=#5294e2 fg=#ffffff bold'
setw -g window-status-style 'bg=#333333 fg=#aaaaaa'
setw -g window-status-separator ''

# Pane borders
set -g pane-border-style 'fg=#333333'
set -g pane-active-border-style 'fg=#5294e2'

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# Aggressive resize - useful when connecting from different devices
setw -g aggressive-resize on

# Double-click to zoom/unzoom pane (mobile-friendly)
bind -n DoubleClick1Pane resize-pane -Z
